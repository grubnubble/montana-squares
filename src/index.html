<html>
<head>
    <title>
        Montana
    </title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.5.1/firebase.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyDtt-9S2GOb1FjHUL8UiAm2d6QqDbcCwOU",
        authDomain: "montana-265c0.firebaseapp.com",
        databaseURL: "https://montana-265c0.firebaseio.com",
        storageBucket: "montana-265c0.appspot.com",
        messagingSenderId: "535748054155"
      };
      firebase.initializeApp(config);
    </script>
</head>
<body id="mainBody" style="width:100%;height:100%; padding:0px; margin:0px">
</body>

<script type="text/javascript">

    $(document).ready(function () {
		//get a random number for each user. use this number to identify their squares. you will also need to assign them a color. random? or let them choose? OR...identify the square by location only(?)
		//really? all this?
		// function randomString(length, chars) { var result = ''; for (var i = length; i > 0; --i) result += chars[Math.floor(Math.random() * chars.length)]; return result; } 
		// 	var rString = randomString(32, '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ');

        var size = 30;
		var database = firebase.database();
		var squareList = database.ref('users/squares/');

        function handleClick (ev) {
            var top = (ev.clientY - (size/2));
            var left = (ev.clientX - (size/2));
            var color = '#990000';
            var thisSquareKey = '';
            var square = '';

    	    function writeNewSquare(left, top, color) {
                //data for new square
    	    	var squareData = {
    	    		x: left,
    	    		y: top,
    	    		color: color
    	    	};

                //get a key for the new square
                var newSquareKey = squareList.child('squares').push().key;
                thisSquareKey = newSquareKey;
                //create the square html object
                square = $('<div id="' + thisSquareKey +'" style="' +
                               'position: absolute; ' +
                               'width: '+ size + 'px; ' +
                               'height: ' + size + 'px; ' +
                               'background-color: ' + color + '; ' +
                               'top:' + top + 'px;' +
                               'left:' + left + 'px;"' +
                               '></div>');

                //write new square
                var list = {};
                list['/users/squares/' + newSquareKey] = squareData;
                return firebase.database().ref().update(list);
    	    };


            // if (!square at (top,left)):
    	    //    write to DB
            writeNewSquare(left, top, color);
            //    and add a square to the screen
            //// console.log(square.get(0));
            $('body').append(square);

    	    //    add a listener to enemy squares (or all squares?)
            // else
            // 	   delete square on screen and in DB
   
        };

        var clickArea = document.getElementById('mainBody');
        clickArea.addEventListener('click', handleClick);

        //draw all squares in the DB
        //doesn't matter what you use for squareId and squareData names
        //now we need to grab the html id from the squares (and write them?)
        //what was my idea here? how to use html ID?
		squareList.on('value', function(snapshot) {
			$.each(snapshot.val(), function(squareId, theSquareData) {
                //won't work bc if it's not already on this page, the jquery object isn't returning anything (bc there is no obj with that ID yet). So this plan isn't going to work, though it's probably good to be able to reference the IDs anyways. Do we need to recreate the square div here then?
                $('body').append($('#' + squareId));
                console.log(squareId);
			});
		});


    });
        
    </script>

</html>