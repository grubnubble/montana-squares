<html>
<head>
    <title>
        Montana
    </title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.5.1/firebase.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyDtt-9S2GOb1FjHUL8UiAm2d6QqDbcCwOU",
        authDomain: "montana-265c0.firebaseapp.com",
        databaseURL: "https://montana-265c0.firebaseio.com",
        storageBucket: "montana-265c0.appspot.com",
        messagingSenderId: "535748054155"
      };
      firebase.initializeApp(config);
    </script>
</head>
<body id="mainBody" style="width:100%;height:100%; padding:0px; margin:0px">
</body>

<script type="text/javascript">

    $(document).ready(function () {
		//get a random number for each user. use this number to identify their squares. you will also need to assign them a color. random? or let them choose? OR...identify the square by location only(?)
		//really? all this?
		// function randomString(length, chars) { var result = ''; for (var i = length; i > 0; --i) result += chars[Math.floor(Math.random() * chars.length)]; return result; } 
		// 	var rString = randomString(32, '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ');

        var size = 30;
		var database = firebase.database();
		var squareList = database.ref('users/squares/');

        function handleClick (ev) {
            var top = (ev.clientY - (size/2));
            var left = (ev.clientX - (size/2));
            var color = '#990000';
    	    function writeSquareData(left, top, color, square) {
    	    	squareList.push({
    	    		x: left,
    	    		y: top,
    	    		color: color,
    	    		html: square
    	    	});
    	    	return squareList.once('value').then(function(snapshot) {
    	    		var squareKey = snapshot.val().squareId;
    	    	})
    	    };
            //squareId is undefined here bc we havent written to the DB
            var square = $('<div id="' +squareList.squareId +'" style="' +
                           'position: absolute; ' +
                           'width: '+ size + 'px; ' +
                           'height: ' + size + 'px; ' +
                           'background-color: ' + color + '; ' +
                           'top:' + top + 'px;' +
                           'left:' + left + 'px;"' +
                           '></div>');

            // if (!square at (top,left)):
    	    //    write to DB
            writeSquareData(left, top, color, square);
            //    and add a square to the screen
            //// console.log(square.get(0));
            $('body').append(square);

    	    //    add a listener to enemy squares (or all squares?)
            // else
            // 	   delete square on screen and in DB
   
        };

        var clickArea = document.getElementById('mainBody');
        clickArea.addEventListener('click', handleClick);

        //draw all squares in the DB
		squareList.on('value', function(snapshot) {
			$.each(snapshot.val(), function(squareId, squareData) {
				$.each(squareData, function(index, value) {
					console.log(value);
				});
			});
		});


    });
        
    </script>

</html>